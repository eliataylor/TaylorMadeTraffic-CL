services:
  apache:
    build:
      context: .
      dockerfile: Dockerfile
    image: php:8.1-apache
    container_name: lamp_apache
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./web:/var/www/html:delegated
      - ./apache-config:/etc/apache2/sites-enabled
      - ./certs:/etc/ssl/certs:ro
    environment:
      - APACHE_RUN_USER=www-data
      - APACHE_RUN_GROUP=www-data
    depends_on:
      - mysql
    command: >
      bash -c "a2enmod ssl && a2enmod rewrite && apache2-foreground"

  mysql:
    image: mysql:8.0
    container_name: lamp_mysql
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ./sql:/docker-entrypoint-initdb.d
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: localdb
      MYSQL_USER: localuser
      MYSQL_PASSWORD: localpassword

volumes:
  mysql-data:
